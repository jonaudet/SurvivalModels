"missed narrowly statistical significance <p>",
"moderately significant <p>",
"modestly significant <p>",
"narrowly avoided significance <p>",
"narrowly eluded statistical significance <p>",
"narrowly escaped significance <p>",
"narrowly evaded statistical significance <p>",
"narrowly failed significance <p>",
"narrowly missed achieving significance <p>",
"narrowly missed overall significance <p>",
"narrowly missed significance <p>",
"narrowly missed standard significance levels <p>",
"narrowly missed the significance level <p>",
"narrowly missing conventional significance <p>",
"near limit significance <p>",
"near miss of statistical significance <p>",
"near nominal significance <p>",
"near significance <p>",
"near to statistical significance <p>",
"near/possible significance<p>",
"near-borderline significance <p>",
"near-certain significance <p>",
"nearing significance <p>",
"nearly acceptable level of significance <p>",
"nearly approaches statistical significance <p>",
"nearly borderline significance <p>",
"nearly negatively significant <p>",
"nearly positively significant <p>",
"nearly reached a significant level <p>",
"nearly reaching the level of significance <p>",
"nearly significant <p>",
"nearly significant tendency <p>",
"nearly, but not quite significant <p>",
"near-marginal significance <p>",
"near-significant <p>",
"near-to-significance <p>",
"near-trend significance <p>",
"nominally significant <p>",
"non-insignificant result <p>",
"non-significant in the statistical sense <p>",
"not absolutely significant but very probably so <p>",
"not as significant <p>",
"not clearly significant <p>",
"not completely significant <p>",
"not completely statistically significant <p>",
"not conventionally significant <p>, but..",
"not currently significant <p>",
"not decisively significant <p>",
"not entirely significant <p>",
"not especially significant <p>",
"not exactly significant <p>",
"not extremely significant <p>",
"not formally significant <p>",
"not fully significant <p>",
"not globally significant <p>",
"not highly significant <p>",
"not insignificant <p>",
"not markedly significant <p>",
"not moderately significant <p>",
"not non-significant <p>",
"not numerically significant <p>",
"not obviously significant <p>",
"not overly significant <p>",
"not quite borderline significance <p>",
"not quite reach the level of significance <p>",
"not quite significant <p>",
"not quite within the conventional bounds of statistical significance <p>",
"not reliably significant <p>",
"not remarkably significant <p>",
"not significant by common standards <p>",
"not significant by conventional standards <p>",
"not significant by traditional standards <p>",
"not significant in the formal statistical sense <p>",
"not significant in the narrow sense of the word <p>",
"not significant in the normally accepted statistical sense <p>",
"not significantly significant but..clinically meaningful <p>",
"not statistically quite significant <p>",
"not strictly significant <p>",
"not strictly speaking significant <p>",
"not technically significant <p>",
"not that significant <p>",
"not to an extent that was fully statistically significant <p>",
"not totally significant <p>",
"not unequivocally significant <p>",
"not very definitely significant <p>",
"not very definitely significant from the statistical point of view <p>",
"not very far from significance <p>",
"not very significant <p>",
"not very statistically significant <p>",
"not wholly significant <p>",
"not yet significant <p>",
"not strongly significant <p>",
"noticeably significant <p>",
"on the border of significance <p>",
"on the borderline of significance <p>",
"on the borderlines of significance <p>",
"on the boundaries of significance <p>",
"on the boundary of significance <p>",
"on the brink of significance <p>",
"on the cusp of conventional statistical significance <p>",
"on the cusp of significance <p>",
"on the edge of significance <p>",
"on the limit to significant <p>",
"on the margin of significance <p>",
"on the threshold of significance <p>",
"on the verge of significance <p>",
"on the very borderline of significance <p>",
"on the very fringes of significance <p>",
"on the very limits of significance <p>",
"only a little short of significance <p>",
"only just failed to meet statistical significance <p>",
"only just insignificant <p>",
"only marginally fails to be significant at the 95% level <p>",
"only marginally nearly insignificant <p>",
"only marginally significant <p>",
"only slightly less than significant <p>",
"only slightly missed the conventional threshold of significance <p>",
"only slightly missed the level of significance <p>",
"only slightly missed the significance level <p>",
"only slightly non-significant <p>",
"only slightly significant <p>",
"partial significance <p>",
"partially significant <p>",
"partly significant <p>",
"perceivable statistical significance <p>",
"possible significance <p>",
"possibly marginally significant <p>",
"possibly significant <p>",
"possibly statistically significant <p>",
"potentially significant <p>",
"practically significant <p>",
"probably not experimentally significant <p>",
"probably not significant <p>",
"probably not statistically significant <p>",
"probably significant <p>",
"provisionally significant <p>",
"quasi-significant <p>",
"questionably significant <p>",
"quite close to significance at the 10% level <p>",
"quite significant <p>",
"rather marginal significance <p>",
"reached borderline significance <p>",
"reached near significance <p>",
"reasonably significant <p>",
"remarkably close to significance <p>",
"resides on the edge of significance <p>",
"roughly significant <p>",
"scarcely significant <p>",
"significant tendency <p>",
"significant to some degree <p>",
"significant, or close to significant effects <p>",
"significantly better overall <p>",
"significantly significant <p>",
"similar but not nonsignificant trends <p>",
"slight evidence of significance <p>",
"slight non-significance <p>",
"slight significance <p>",
"slight tendency toward significance <p>",
"slightly above the level of significance <p>",
"slightly below the level of significance <p>",
"slightly exceeded significance level <p>",
"slightly failed to reach statistical significance <p>",
"slightly insignificant <p>",
"slightly less than needed for significance <p>",
"slightly marginally significant <p>",
"slightly missed being of statistical significance <p>",
"slightly missed statistical significance <p>",
"slightly missed the conventional level of significance <p>",
"slightly missed the level of statistical significance <p>",
"slightly missed the margin of significance <p>",
"slightly not significant <p>",
"slightly outside conventional statistical significance <p>",
"slightly outside the margins of significance <p>",
"slightly outside the range of significance <p>",
"slightly outside the significance level <p>",
"slightly outside the statistical significance level <p>",
"slightly significant <p>",
"somewhat marginally significant <p>",
"somewhat short of significance <p>",
"somewhat significant <p>",
"somewhat statistically significant <p>",
"strong trend toward significance <p>",
"sufficiently close to significance <p>",
"suggestive but not quite significant <p>",
"suggestive of a significant trend <p>",
"suggestive of statistical significance <p>",
"suggestively significant <p>",
"tailed to insignificance <p>",
"tantalisingly close to significance <p>",
"technically not significant <p>",
"teetering on the brink of significance <p>",
"tend to significant <p>",
"tended to approach significance <p>",
"tended to be significant <p>",
"tended toward significance <p>",
"tendency toward significance <p>",
"tendency toward statistical significance <p>",
"tends to approach significance <p>",
"tentatively significant <p>",
"too far from significance <p>",
"trend bordering on statistical significance <p>",
"trend in a significant direction <p>",
"trend in the direction of significance <p>",
"trend significance level <p>",
"trend toward <p>",
"trending towards significance <p>",
"trending towards significant <p>",
"uncertain significance <p>",
"vaguely significant <p>",
"verged on being significant <p>",
"verging on significance <p>",
"verging on the statistically significant <p>",
"verging-on-significant <p>",
"very close to approaching significance <p>",
"very close to significant <p>",
"very close to the conventional level of significance <p>",
"very close to the cut-off for significance <p>",
"very close to the established statistical significance level of p=0.05 <p>",
"very close to the threshold of significance <p>",
"very closely approaches the conventional significance level <p>",
"very closely brushed the limit of statistical significance <p>",
"very narrowly missed significance <p>",
"very nearly significant <p>",
"very slightly non-significant <p>",
"very slightly significant <p>",
"virtually significant <p>",
"weak significance <p>",
"weakened..significance <p>",
"weakly non-significant <p>",
"weakly significant <p>",
"weakly statistically significant <p>",
"well-nigh significant <p>")
cat("  Test of Significance\n")
cat("\n")
cat("H0: p will be more than 0.05\n")
cat("H1: p will be less than 0.05\n")
cat("\n")
cat("  Result\n")
if(p < 0.0001) {
cat("significant beyond doubt (p < 0.0001)\n")
} else if(p < 0.001) {
cat("extremely significant (p < 0.001)\n")
} else if(p < 0.01) {
cat(paste("highly significant (p = ",  round(p, 4) , ")\n", sep="" ))
} else if(p < 0.05) {
cat(paste("significant (p = ",  round(p, 4) , ")\n", sep="" ))
} else if(p < 0.12) {
excuse <- gsub("<p>", paste("(p = ", round(p, 4), ")",sep=""), p_excuses[sample(seq_along(p_excuses), 1)])
cat(excuse, "\n")
} else {
cat("not significant (n.s.)")
}
invisible(p)
}
signif.text(0.1)
signif.test(0.1)
signif.test(c(1, -1, 0))
signif.test(c(1, -1, 0))
signif.test(c(1, -2, 0))
signif.test(c(1, -2, -1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
signif.test(c(3.9, 8.9, -1.2, 8.9, 2.1))
library(rstan)
res3 <- readRDS("C:/Users/jaudet/Desktop/Results_2016-06-03.RDS/)")
res3 <- readRDS("C:/Users/jaudet/Desktop/Results_2016-06-03.RDS")
library(shinystan)
launch_shinystan(res3)
setwd("E:/Analysis/Code")
library(checkpoint)
checkpoint("2016-02-15")
knitr::opts_chunk$set(echo = TRUE)
library(checkpoint)
checkpoint("2016-02-15")
library(rstan)
library(readxl)
library(readr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(Hmisc)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
source("Surv_funcs.R")
Weight_Score <- read_excel("../Data/Fabs1/Weight_Score.xlsx")
Weight <- Weight_Score %>%
select(Antibody, Format, Day, contains("Weight")) %>%
gather("Sub", "Weight", Weight_1:Weight_10) %>%
separate(Sub, c("Rem", "Num"), sep = "_") %>%
select(-Rem) %>%
filter(!is.na(Weight)) %>%
mutate(Num = paste(Format, Num, sep = "_"))
Score <- Weight_Score %>%
select(Antibody, Format, Day, contains("Score")) %>%
gather("Sub", "Score", Score_1:Score_10) %>%
separate(Sub, c("Rem", "Num"), sep = "_") %>%
select(-Rem) %>%
filter(!is.na(Score)) %>%
mutate(Num = paste(Format, Num, sep = "_"))
TTD <- Score %>%
group_by(Antibody, Format, Num) %>%
top_n(1, Day) %>%
summarise(Outcome = ifelse(Score == 4, 1, 0),
Time = ifelse(Day == 14, 28, Day)) %>%
ungroup
source("https://raw.githubusercontent.com/kmiddleton/rexamples/master/qplot_survival.R")
library(survival)
Su <- Surv(TTD$Time, event = TTD$Outcome)
TTD$Group <- TTD$Format
fit <- survfit(Su ~ TTD$Antibody + TTD$Group)
s_frame <- createSurvivalFrame(fit) %>%
tbl_df %>%
separate(strata, c("Antibody", "Group"), sep = ", ") %>%
separate(Antibody, c("Rem1", "Antibody"), sep = "=") %>%
separate(Group, c("Rem2", "Group"), sep = "=") %>%
select(-Rem1, -Rem2, -upper, -lower, -n.risk, -n.event, -n.censor) %>%
mutate(Antibody = gsub("^\\s+|\\s+$", "", Antibody),
Group = gsub("^\\s+|\\s+$", "", Group))
ggplot(Weight, aes(Day, Weight, group = Num, colour = Format)) +
geom_point() +
geom_line() +
facet_wrap(~Antibody) +
theme_bw()
ggplot(Weight, aes(Day, Weight, group = Num, colour = Format)) +
facet_wrap(~Antibody) +
geom_line(alpha = 0.4) +
stat_summary(aes(group = NULL), fun.data = "mean_cl_boot", size = .65) +
stat_summary(aes(group = NULL), fun.y = "mean", geom = "line", size = 1.1) +
theme_bw()
Weight %>%
group_by(Antibody, Format, Num) %>%
arrange(Day) %>%
mutate(Weight_change = Weight / Weight[1] * 100) %>%
ungroup %>%
ggplot(aes(Day, Weight_change, group = Num, colour = Format)) +
geom_point() +
geom_line() +
facet_wrap(~Antibody) +
theme_bw()
Weight %>%
group_by(Antibody, Format, Num) %>%
arrange(Day) %>%
mutate(Weight_change = Weight / Weight[1] * 100) %>%
ungroup %>%
ggplot(aes(Day, Weight_change, group = Num, colour = Format)) +
facet_wrap(~Antibody) +
geom_line(alpha = 0.4) +
stat_summary(aes(group = NULL), fun.data = "mean_cl_boot", size = 0.65) +
stat_summary(aes(group = NULL), fun.y = "mean", geom = "line", size = 1.1) +
theme_bw()
exec <- stan("../Models/survival_lnormal_cens.stan")
out_lognorm <- TTD %>%
filter(Antibody != "PBS") %>%
group_by(Antibody) %>%
do(Surv_LogNorm(., .$Antibody[1], "Fabs1", s_frame, exec)) %>%
ungroup
exec <- stan("../Models/survival_gamma_cens.stan")
out_gamma <- TTD %>%
filter(Antibody != "PBS") %>%
group_by(Antibody) %>%
do(Surv_Gamma(., .$Antibody[1], "Fabs1", s_frame, exec)) %>%
ungroup
exec <- stan("../Models/survival_weibull_cens.stan")
out_weibull <- TTD %>%
filter(Antibody != "PBS") %>%
group_by(Antibody) %>%
do(Surv_Weibull(., .$Antibody[1], "Fabs1", s_frame, exec)) %>%
ungroup
exec <- stan("../Models/survival_logistic_cens.stan")
out_logistic <- TTD %>%
filter(Antibody != "PBS") %>%
group_by(Antibody) %>%
do(Surv_Logistic(., .$Antibody[1], "Fabs1", s_frame, exec)) %>%
ungroup
exec <- stan("../Models/survival_exponential_cens.stan")
out_exp <- TTD %>%
filter(Antibody != "PBS") %>%
group_by(Antibody) %>%
do(Surv_Exponential(., .$Antibody[1], "Fabs1", s_frame, exec)) %>%
ungroup
out <- bind_rows(out_lognorm,
out_gamma,
out_weibull,
out_logistic,
out_exp)
out_sim <- filter(out, Group != "Diff")
x <- seq(0, 30, length.out = 200)
Calc_Hazard <- function(df, x){
if(df$Model[1] == "LogNormal")
out <- dlnorm(x, df$Scale_Median, exp(df$Shape_Median))
else if(df$Model[1] == "Gamma")
out <- dgamma(x, df$Shape_Median, scale = df$Scale_Median)
else if(df$Model[1] == "Weibull")
out <- dweibull(x, exp(df$Shape_Median), exp(df$Scale_Median))
else if(df$Model[1] == "Logistic")
out <- dlogis(x, df$Scale_Median, exp(df$Shape_Median))
else
out <- dexp(x, exp(df$Scale_Median))
df <- df %>%
select(Antibody, Model, Group) %>%
cbind(matrix(out, nrow = 1))
return(df)
}
Calc_Surv <- function(df, x){
if(df$Model[1] == "LogNormal")
out <- plnorm(x, df$Scale_Median, exp(df$Shape_Median), lower.tail = F)
else if(df$Model[1] == "Gamma")
out <- pgamma(x, df$Shape_Median, scale = df$Scale_Median, lower.tail = F)
else if(df$Model[1] == "Weibull")
out <- pweibull(x, exp(df$Shape_Median), exp(df$Scale_Median), lower.tail = F)
else if(df$Model[1] == "Logistic")
out <- plogis(x, df$Scale_Median, exp(df$Shape_Median), lower.tail = F)
else
out <- pexp(x, exp(df$Scale_Median), lower.tail = F)
df <- df %>%
select(Antibody, Model, Group) %>%
cbind(matrix(out, nrow = 1))
return(df)
}
res_sim <- out_sim %>%
group_by(Antibody, Model, Group) %>%
do(Calc_Hazard(., x)) %>%
ungroup %>%
gather("Rem", "Prob", 4:203) %>%
mutate(X = rep(x, each = 32)) %>%
select(-Rem)
res_sim <- out_sim %>%
group_by(Antibody, Model, Group) %>%
do(Calc_Hazard(., x)) %>%
ungroup %>%
gather("Rem", "Prob", 4:203) %>%
mutate(X = rep(x, each = 40)) %>%
select(-Rem)
res_surv <- out_sim %>%
group_by(Antibody, Model, Group) %>%
do(Calc_Surv(., x)) %>%
ungroup %>%
gather("Rem", "Surv", 4:203) %>%
mutate(X = rep(x, each = 40)) %>%
select(-Rem)
ggplot(res_sim, aes(X, Prob, colour = Group)) +
geom_step(data = s_frame, aes(x = time, y = surv), size = 1.1) +
geom_line(aes(linetype = Model)) +
facet_wrap(~Antibody) +
theme_bw()
ggplot(res_surv, aes(X, Surv, colour = Group)) +
geom_step(data = s_frame, aes(x = time, y = surv), size = 1.1) +
geom_line(aes(linetype = Model)) +
facet_wrap(~Antibody) +
theme_bw()
ggplot(res_sim, aes(X, Prob, colour = Group)) +
geom_step(data = s_frame, aes(x = time, y = surv), size = 1.1) +
geom_line(aes(linetype = Model)) +
facet_wrap(~Antibody) +
theme_bw()
ggsave("../Results/Fabs1/Model_Comp.pdf", width = 8, height = 6)
ggplot(res_surv, aes(X, Surv, colour = Group)) +
geom_step(data = s_frame, aes(x = time, y = surv), size = 1.1) +
geom_line(aes(linetype = Model)) +
facet_wrap(~Antibody) +
theme_bw()
ggsave("../Results/Fabs1/Model_Comp_Surv.pdf", width = 8, height = 6)
ggplot(Weight, aes(Day, Weight, group = Num, colour = Format)) +
facet_wrap(~Antibody) +
geom_line(alpha = 0.4) +
stat_summary(aes(group = NULL), fun.data = "mean_cl_boot", size = .65) +
stat_summary(aes(group = NULL), fun.y = "mean", geom = "line", size = 1.1) +
theme_bw()
ggsave("../Results/Fabs1/Weight.pdf", width = 8, height = 6)
Weight %>%
group_by(Antibody, Format, Num) %>%
arrange(Day) %>%
mutate(Weight_change = Weight / Weight[1] * 100) %>%
ungroup %>%
ggplot(aes(Day, Weight_change, group = Num, colour = Format)) +
facet_wrap(~Antibody) +
geom_line(alpha = 0.4) +
stat_summary(aes(group = NULL), fun.data = "mean_cl_boot", size = 0.65) +
stat_summary(aes(group = NULL), fun.y = "mean", geom = "line", size = 1.1) +
theme_bw()
ggsave("../Results/Fabs1/Weight.pdf", width = 8, height = 6)
ggsave("../Results/Fabs1/Weight_Change.pdf", width = 8, height = 6)
ggplot(Weight, aes(Day, Weight, group = Num, colour = Format)) +
facet_wrap(~Antibody) +
geom_line(alpha = 0.4) +
stat_summary(aes(group = NULL), fun.data = "mean_cl_boot", size = .65) +
stat_summary(aes(group = NULL), fun.y = "mean", geom = "line", size = 1.1) +
theme_bw()
ggsave("../Results/Fabs1/Weight.pdf", width = 8, height = 6)
write_csv(out, "../Results/Fabs1/Results.csv")
rlnorm(1, -3, 2, 3)
rlnorm(1, -3, 2)
